// test-manager-integration.js - ะขะตัั ะพะฑะฝะพะฒะปัะฝะฝะพะณะพ FootprintManager
const { FootprintManager } = require('./modules/footprint');

console.log('๐ฏ ะขะะกะข ะะะะะะะะะะะะ FOOTPRINTMANAGER');
console.log('======================================\n');

// ะกะพะทะดะฐัะผ ะผะตะฝะตะดะถะตั
const manager = new FootprintManager({
ยยย autoAlignment: true,
ยยย requireConfirmation: false
});

console.log('โ ะะตะฝะตะดะถะตั ัะพะทะดะฐะฝ');
console.log(`๐ง ะะฒัะพัะพะฒะผะตัะตะฝะธะต: ${manager.alignmentConfig.enabled ? 'ะฒะบะปััะตะฝะพ' : 'ะฒัะบะปััะตะฝะพ'}\n`);

// 1. ะะฐัะธะฝะฐะตะผ ะฝะพะฒัั ัะตััะธั
console.log('1. ๐ ะะะงะะะ ะะะะะ ะกะะกะกะะ');
const session = manager.startNewSession('test_user', 'ะขะตััะพะฒะฐั ัะตััะธั ั ัะพะฒะผะตัะตะฝะธะตะผ');
console.log(`ยย ID ัะตััะธะธ: ${session.id}`);
console.log(`ยย ะะฐะทะฒะฐะฝะธะต: ${session.name}`);
console.log(`ยย ะะพะปัะทะพะฒะฐัะตะปั: ${session.userId}`);

// 2. ะกะพะทะดะฐัะผ ัะตััะพะฒัะน ะฐะฝะฐะปะธะท
console.log('\n2. ๐ธ ะกะะะะะะะ ะขะะกะขะะะะะ ะะะะะะะ');
const testAnalysis = {
ยยย id: 'test_analysis_1',
ยยย predictions: [
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 100, y: 100}, {x: 120, y: 100}, {x: 110, y: 120}],
ยยยยยยยยยยย confidence: 0.9
ยยยยยยย },
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 200, y: 150}, {x: 220, y: 150}, {x: 210, y: 170}],
ยยยยยยยยยยย confidence: 0.8
ยยยยยยย },
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 150, y: 250}, {x: 170, y: 250}, {x: 160, y: 270}],
ยยยยยยยยยยย confidence: 0.85
ยยยยยยย }
ยยย ],
ยยย timestamp: new Date()
};

// 3. ะะพะฑะฐะฒะปัะตะผ ัะพัะพ ะฒ ัะตััะธั
console.log('\n3. ๐ฅ ะะะะะะะะะะ ะคะะขะ ะ ะกะะกะกะะฎ');
const result1 = manager.addPhotoToSession(testAnalysis, 'test1.jpg', { quality: 0.8 });
console.log(`ยย ะะตะทัะปััะฐั: ${result1.success ? 'ััะฟะตัะฝะพ' : 'ะพัะธะฑะบะฐ'}`);
console.log(`ยย ะฃะทะปะพะฒ ะดะพะฑะฐะฒะปะตะฝะพ: ${result1.added || 0}`);
console.log(`ยย ะฃะทะปะพะฒ ะพะฑัะตะดะธะฝะตะฝะพ: ${result1.merged || 0}`);

// 4. ะกัะฐัะธััะธะบะฐ ัะตััะธะธ
console.log('\n4. ๐ ะกะขะะขะะกะขะะะ ะกะะกะกะะ');
const sessionStats = manager.getSessionStats();
if (sessionStats) {
ยยย console.log(`ยย ะคะพัะพ: ${sessionStats.photosCount}`);
ยยย console.log(`ยย ะะฝะฐะปะธะทะพะฒ: ${sessionStats.analysesCount}`);
ยยย console.log(`ยย ะฃัะฟะตัะฝัั ัะพะฒะผะตัะตะฝะธะน: ${sessionStats.successfulAlignments}`);
ยยย console.log(`ยย ะกัะตะดะฝะธะน score: ${(sessionStats.avgAlignmentScore * 100).toFixed(1)}%`);
}

// 5. ะะพะฑะฐะฒะปัะตะผ ะฒัะพัะพะต ัะพัะพ (ะฝะตะผะฝะพะณะพ ัะผะตััะฝะฝะพะต)
console.log('\n5. ๐ฅ ะะะะะะะะะะ ะะขะะะะะ ะคะะขะ (ัะผะตััะฝะฝะพะต)');
const testAnalysis2 = {
ยยย id: 'test_analysis_2',
ยยย predictions: [
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 105, y: 105}, {x: 125, y: 105}, {x: 115, y: 125}],
ยยยยยยยยยยย confidence: 0.9
ยยยยยยย },
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 205, y: 155}, {x: 225, y: 155}, {x: 215, y: 175}],
ยยยยยยยยยยย confidence: 0.8
ยยยยยยย },
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 155, y: 255}, {x: 175, y: 255}, {x: 165, y: 275}],
ยยยยยยยยยยย confidence: 0.85
ยยยยยยย }
ยยย ],
ยยย timestamp: new Date()
};

const result2 = manager.addPhotoToSession(testAnalysis2, 'test2.jpg', { quality: 0.8 });
console.log(`ยย ะะตะทัะปััะฐั: ${result2.success ? 'ััะฟะตัะฝะพ' : 'ะพัะธะฑะบะฐ'}`);
if (result2.alignmentScore) {
ยยย console.log(`ยย Score ัะพะฒะผะตัะตะฝะธั: ${(result2.alignmentScore * 100).toFixed(1)}%`);
}

// 6. ะะฝัะพัะผะฐัะธั ะพ ัะพะฒะผะตัะตะฝะธัั
console.log('\n6. ๐ ะะะคะะะะะฆะะฏ ะ ะกะะะะะฉะะะะฏะฅ');
const alignmentInfo = manager.getAlignmentInfo();
if (alignmentInfo) {
ยยย console.log(`ยย ะัะตะณะพ ัะพะฒะผะตัะตะฝะธะน: ${alignmentInfo.totalAlignments}`);
ยยย console.log(`ยย ะฃัะฟะตัะฝัั: ${alignmentInfo.successfulAlignments}`);
ยยย console.log(`ยย ะกัะตะดะฝะธะน score: ${(alignmentInfo.avgScore * 100).toFixed(1)}%`);
ยยย console.log(`ยย ะัััะธะน score: ${(alignmentInfo.bestScore * 100).toFixed(1)}%`);
}

// 7. ะัะตะฝะบะฐ ะบะฐัะตััะฒะฐ ะผะพะดะตะปะธ
console.log('\n7. ๐ฏ ะะฆะะะะ ะะะงะะกะขะะ ะะะะะะ');
const quality = manager.assessModelQuality();
if (quality) {
ยยย console.log(`ยย ะะฑัะธะน score: ${(quality.overallScore * 100).toFixed(1)}%`);
ยยย console.log(`ยย ะัะตะฝะบะฐ: ${quality.grade} - ${quality.message}`);
ยยย console.log(`ยย ะฃะทะปะพะฒ: ${quality.nodes}`);
ยยย console.log(`ยย ะฃะฒะตัะตะฝะฝะพััั: ${(quality.confidence * 100).toFixed(1)}%`);
}

// 8. ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะปัััะตะฝะธั
console.log('\n8. ๐ก ะะะะะะะะะะฆะะ ะะ ะฃะะฃะงะจะะะะฎ');
const recommendations = manager.getImprovementRecommendations();
if (recommendations.length > 0) {
ยยย recommendations.forEach((rec, index) => {
ยยยยยยย console.log(`ยย ${index + 1}. [${rec.priority.toUpperCase()}] ${rec.message}`);
ยยย });
} else {
ยยย console.log('ยย โ ะะพะดะตะปั ัะพัะพัะตะณะพ ะบะฐัะตััะฒะฐ, ัะตะบะพะผะตะฝะดะฐัะธะน ะฝะตั');
}

// 9. ะกะพััะฐะฝัะตะผ ะผะพะดะตะปั
console.log('\n9. ๐พ ะกะะฅะะะะะะะ ะะะะะะ');
const saveResult = manager.saveSessionAsModel('ะขะตััะพะฒะฐั ะผะพะดะตะปั ั ัะพะฒะผะตัะตะฝะธะตะผ');
if (saveResult.success) {
ยยย console.log(`ยย โ ะะพะดะตะปั ัะพััะฐะฝะตะฝะฐ ั ID: ${saveResult.modelId}`);
ยยย console.log(`ยย ๐ ะกัะฐัะธััะธะบะฐ ัะพััะฐะฝัะฝะฝะพะน ะผะพะดะตะปะธ:`);
ยยย console.log(`ยยยยย โข ะฃะทะปะพะฒ: ${saveResult.stats.nodes}`);
ยยย console.log(`ยยยยย โข ะะตะฑะตั: ${saveResult.stats.edges}`);
ยยย console.log(`ยยยยย โข ะะฐัะตััะฒะพ: ${(saveResult.stats.topologyQuality * 100).toFixed(1)}%`);
} else {
ยยย console.log(`ยย โ ะัะธะฑะบะฐ ัะพััะฐะฝะตะฝะธั: ${saveResult.error}`);
}

console.log('\n๐ ===== ะะขะะะ ะขะะกะขะ =====');
console.log(`โ FootprintManager ะพะฑะฝะพะฒะปัะฝ ะดะปั ัะฐะฑะพัั ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ัะพะฒะผะตัะตะฝะธะตะผ`);
console.log(`โ ะัะต ะผะตัะพะดั ัะฐะฑะพัะฐัั ะบะพััะตะบัะฝะพ`);
console.log(`โ ะะพะดะตะปั ัะพะทะดะฐะฝะฐ ะธ ัะพััะฐะฝะตะฝะฐ`);
console.log(`โ ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะธะฝัะตะณัะฐัะธะธ ะฒ ะฑะพัะฐ`);

console.log('\n๐ง ะกะะะะฃะฎะฉะะ ะจะะะ:');
console.log('1. ะะฝัะตะณัะธัะพะฒะฐัั ะพะฑะฝะพะฒะปัะฝะฝัะน ะผะตะฝะตะดะถะตั ะฒ ะฑะพัะฐ');
console.log('2. ะะฑะฝะพะฒะธัั ะบะพะผะฐะฝะดั ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฐะฒัะพัะพะฒะผะตัะตะฝะธั');
console.log('3. ะัะพัะตััะธัะพะฒะฐัั ะฝะฐ ัะตะฐะปัะฝัั ะดะฐะฝะฝัั');
