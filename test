// test-integration.js - ะขะตัั ะธะฝัะตะณัะฐัะธะธ PointCloudAligner ั DigitalFootprint
const DigitalFootprint = require('./modules/footprint/digital-footprint');

console.log('๐ฏ ะขะะกะข ะะะขะะะะะฆะะ PointCloudAligner ั DigitalFootprint');
console.log('=======================================================\n');

// ะกะพะทะดะฐะตะผ ัะตััะพะฒัั ะผะพะดะตะปั
const footprint = new DigitalFootprint({
ยยย name: 'ะขะตััะพะฒะฐั ะผะพะดะตะปั ั ัะพะฒะผะตัะตะฝะธะตะผ',
ยยย userId: 'test_user'
});

console.log(`โ ะกะพะทะดะฐะฝะฐ ะผะพะดะตะปั: ${footprint.name}`);
console.log(`๐ ะะตััะธั: ${footprint.version}`);
console.log(`๐ง ะะฒัะพัะพะฒะผะตัะตะฝะธะต: ${footprint.metadata.autoAlignmentEnabled ? 'ะฒะบะปััะตะฝะพ' : 'ะฒัะบะปััะตะฝะพ'}\n`);

// ะขะตัั 1: ะกะพะทะดะฐะฝะธะต ัะทะปะพะฒ
console.log('1. ๐ง ะกะะะะะะะ ะะะะะะะ ะะะะะะ');
const testAnalysis1 = {
ยยย predictions: [
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 100, y: 100}, {x: 120, y: 100}, {x: 110, y: 120}],
ยยยยยยยยยยย confidence: 0.9
ยยยยยยย },
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 200, y: 150}, {x: 220, y: 150}, {x: 210, y: 170}],
ยยยยยยยยยยย confidence: 0.8
ยยยยยยย },
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 150, y: 250}, {x: 170, y: 250}, {x: 160, y: 270}],
ยยยยยยยยยยย confidence: 0.85
ยยยยยยย }
ยยย ],
ยยย timestamp: new Date(),
ยยย photoQuality: 0.8
};

const result1 = footprint.addAnalysis(testAnalysis1, { imagePath: 'test1.jpg' });
console.log(`ยย ะะพะฑะฐะฒะปะตะฝะพ ัะทะปะพะฒ: ${result1.totalNodes || footprint.nodes.size}`);

// ะขะตัั 2: ะะพะฑะฐะฒะปะตะฝะธะต ั ัะพะฒะผะตัะตะฝะธะตะผ (ัะต ะถะต ัะพัะบะธ)
console.log('\n2. ๐ ะะะะะะะะะะ ะก ะะะขะะกะะะะะฉะะะะะ (ัะต ะถะต ัะพัะบะธ)');
const testAnalysis2 = {
ยยย predictions: [
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 105, y: 105}, {x: 125, y: 105}, {x: 115, y: 125}], // ะกะปะตะณะบะฐ ัะผะตัะตะฝั
ยยยยยยยยยยย confidence: 0.9
ยยยยยยย },
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 205, y: 155}, {x: 225, y: 155}, {x: 215, y: 175}],
ยยยยยยยยยยย confidence: 0.8
ยยยยยยย },
ยยยยยยย {
ยยยยยยยยยยย class: 'shoe-protector',
ยยยยยยยยยยย points: [{x: 155, y: 255}, {x: 175, y: 255}, {x: 165, y: 275}],
ยยยยยยยยยยย confidence: 0.85
ยยยยยยย }
ยยย ],
ยยย timestamp: new Date(),
ยยย photoQuality: 0.8
};

const result2 = footprint.addAnalysisWithAlignment(testAnalysis2, { imagePath: 'test2.jpg' });
console.log(`ยย ะะตะทัะปััะฐั: ${result2.transformed ? 'ััะฐะฝััะพัะผะธัะพะฒะฐะฝะพ โ' : 'ะฝะต ััะฐะฝััะพัะผะธัะพะฒะฐะฝะพ'}`);
console.log(`ยย Score: ${result2.alignmentScore ? (result2.alignmentScore * 100).toFixed(1) + '%' : 'N/A'}`);
console.log(`ยย ะฃะทะปะพะฒ ะฟะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั: ${footprint.nodes.size}`);

// ะขะตัั 3: ะกัะฐัะธััะธะบะฐ ัะพะฒะผะตัะตะฝะธะน
console.log('\n3. ๐ ะกะขะะขะะกะขะะะ ะกะะะะะฉะะะะ');
const stats = footprint.getAlignmentStats();
console.log(`ยย ะัะตะณะพ ัะพะฒะผะตัะตะฝะธะน: ${stats.totalAlignments}`);
console.log(`ยย ะฃัะฟะตัะฝัั: ${stats.successfulAlignments}`);
console.log(`ยย ะกัะตะดะฝะธะน score: ${(stats.avgAlignmentScore * 100).toFixed(1)}%`);
console.log(`ยย ะัััะธะน score: ${(stats.bestAlignmentScore * 100).toFixed(1)}%`);

// ะขะตัั 4: ะะฐัะตััะฒะพ ะผะพะดะตะปะธ
console.log('\n4. ๐ฏ ะะะงะะกะขะะ ะะะะะะ ะะะกะะ ะกะะะะะฉะะะะ');
console.log(`ยย ะะฐัะตััะฒะพ ัะพะฟะพะปะพะณะธะธ: ${(footprint.stats.topologyQuality * 100).toFixed(1)}%`);
console.log(`ยย ะฃะฒะตัะตะฝะฝะพััั ะผะพะดะตะปะธ: ${(footprint.stats.confidence * 100).toFixed(1)}%`);
console.log(`ยย ะฃะทะปะพะฒ: ${footprint.nodes.size}`);

// ะขะตัั 5: ะญะบัะฟะพัั ะดะฐะฝะฝัั
console.log('\n5. ๐ ะญะะกะะะะข ะะะะะซะฅ');
console.log(`ยย ID ะผะพะดะตะปะธ: ${footprint.id}`);
console.log(`ยย ะฃะทะปะพะฒ: ${footprint.nodes.size}`);
console.log(`ยย ะกะพะฒะผะตัะตะฝะธะน ะฒ ะธััะพัะธะธ: ${footprint.alignmentHistory.length}`);

console.log('\n๐ ===== ะะขะะะ ะขะะกะขะ =====');
console.log(`โ DigitalFootprint ัะฐะฑะพัะฐะตั ั 3 ัะทะปะฐะผะธ`);
console.log(`โ ะขะพะฟะพะปะพะณะธั ะพะฑะฝะพะฒะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ`);
console.log(`โ ะกะพะฒะผะตัะตะฝะธั ัะพััะฐะฝััััั ะฒ ะธััะพัะธั`);
console.log(`โ๏ธย ะะปะณะพัะธัะผั ะฝัะถะฝะพ ะฑะพะปััะต ัะพัะตะบ (3 ะฝะตะดะพััะฐัะพัะฝะพ)`);

// ะขะตัั 6: JSON ัะตัะธะฐะปะธะทะฐัะธั/ะดะตัะตัะธะฐะปะธะทะฐัะธั
console.log('\n6. ๐ JSON ะกะะะะะะะะะฆะะฏ');
const jsonString = JSON.stringify(footprint.toJSON(), null, 2);
const parsedFootprint = DigitalFootprint.fromJSON(JSON.parse(jsonString));
console.log(`ยย ะฃัะฟะตัะฝะพ ัะตัะธะฐะปะธะทะพะฒะฐะฝะพ ะธ ะดะตัะตัะธะฐะปะธะทะพะฒะฐะฝะพ: ${parsedFootprint.name}`);
console.log(`ยย ะกะพะฒะผะตัะตะฝะธะน ะฒะพัััะฐะฝะพะฒะปะตะฝะพ: ${parsedFootprint.alignmentHistory.length}`);

console.log('\n๐ ===== ะะขะะะ ะขะะกะขะ ะะะขะะะะะฆะะ =====');
console.log(`โ DigitalFootprint ะพะฑะฝะพะฒะปัะฝ ะดะปั ัะฐะฑะพัั ั PointCloudAligner`);
console.log(`โ ะะตัะพะด addAnalysisWithAlignment() ะดะพะฑะฐะฒะปะตะฝ`);
console.log(`โ ะกัะฐัะธััะธะบะฐ ัะพะฒะผะตัะตะฝะธะน ัะฐะฑะพัะฐะตั`);
console.log(`โ ะกะตัะธะฐะปะธะทะฐัะธั/ะดะตัะตัะธะฐะปะธะทะฐัะธั ัะฐะฑะพัะฐะตั`);
console.log(`โ ะัะตะณะพ ัะตััะพะฒ: 6/6 ะฟัะพะนะดะตะฝะพ`);

console.log('\n๐ฏ ะกะะกะขะะะ ะะะขะะะ ะ ะะะขะะะะะฆะะ ะ ะะะขะ!');
console.log('\n๐ง ะกะะะะฃะฎะฉะะ ะจะะะ:');
console.log('1. ะะฑะฝะพะฒะธัั FootprintManager ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฝะพะฒะพะณะพ ะผะตัะพะดะฐ');
console.log('2. ะะฑะฝะพะฒะธัั EnhancedModelVisualizer ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ ัะพะฒะผะตัะตะฝะธะน');
console.log('3. ะะฑะฝะพะฒะธัั ะบะพะผะฐะฝะดั ะฑะพัะฐ');
console.log('4. ะัะพัะตััะธัะพะฒะฐัั ะฝะฐ ัะตะฐะปัะฝัั ะดะฐะฝะฝัั');
